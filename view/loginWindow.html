<!DOCTYPE html>
<html>
   <head>
      <meta charset="utf-8" />
      <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
      <title>
         Stitchel
      </title>
      <!-- Favicon -->
      <!-- Fonts -->
      <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,600,700" rel="stylesheet">
      <!-- Icons -->
      <link href="../public/argon/assets/js/plugins/nucleo/css/nucleo.css" rel="stylesheet" />
      <script src="https://kit.fontawesome.com/2a3479ee76.js" crossorigin="anonymous"></script>
      <!-- CSS Files -->
      <link href="../public/argon/assets/css/argon-dashboard.css?v=1.1.0&ev_version=1&ev_version=1'" rel="stylesheet" />
      <link href="../public/argon/assets/css/main.css" rel="stylesheet" />
      <link href="../public/css/global.css?v='.time()" rel="stylesheet" />
   </head>
   <body class="bg-default">
      <div class="main-content">
         <!-- Navbar -->
         <nav class="navbar navbar-top navbar-horizontal navbar-expand-md navbar-dark">
            <div class="container px-4">
               <a class="navbar-brand" href="">
                  <x-logo>Stitchel Logo</x-logo>
               </a>
               <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-collapse-main" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
               <span class="navbar-toggler-icon"></span>
               </button>
               <div class="collapse navbar-collapse" id="navbar-collapse-main">
                  <!-- Collapse header -->
                  <div class="navbar-collapse-header d-md-none">
                     <div class="row">
                        <div class="col-6 collapse-brand">
                        </div>
                        <div class="col-6 collapse-close">
                           <button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#navbar-collapse-main" aria-controls="sidenav-main" aria-expanded="false" aria-label="Toggle sidenav">
                           <span></span>
                           <span></span>
                           </button>
                        </div>
                     </div>
                  </div>
               </div>
            </div>
         </nav>
         <!-- Header -->
         <div class="header bg-gradient-primary py-7 py-lg-8">
            <div class="float-right" id="result" style="margin-right: 10px;"></div>
            <div class="container">
               <div class="header-body text-center mb-7">
                  <div class="row justify-content-center">
                     <div class="col-lg-5 col-md-6">
                        <h1 class="text-white">Welcome!</h1>
                        <p class="text-lead text-light">Please sign in below.</p>
                     </div>
                  </div>
               </div>
            </div>
            <div class="separator separator-bottom separator-skew zindex-100">
               <svg x="0" y="0" viewBox="0 0 2560 100" preserveAspectRatio="none" version="1.1" xmlns="http://www.w3.org/2000/svg">
                  <polygon class="fill-default" points="2560 0 2560 100 0 100"></polygon>
               </svg>
            </div>
         </div>
         <!-- Page content -->
         <div class="container mt--8 pb-5">
            <div class="row justify-content-center">
               <div class="col-lg-5 col-md-7">
                  <div class="card bg-secondary shadow border-0" style="margin-top: -6rem;">
                     <div class="card-body px-lg-5 py-lg-5">
                        <form id="loginForm">
                           <div class="form-group">
                              <label class="label">Email</label>
                              <div class="input-group">
                                 <input  type="email"
                                    class="form-control email" name="email"
                                    value="" required autocomplete="email" autofocus>
                                 <div class="input-group-append">
                                    <span class="input-group-text">
                                    <i class="fas fa-user"></i>
                                    </span>
                                 </div>
                                 <span class="invalid-feedback d-block" role="alert">
                                    <strong class="error-email"></strong>
                                  </span>
                              </div>
                           </div>
                           <div class="form-group">
                              <label class="label">Password</label>
                              <div class="input-group">
                                 <input type="password"
                                    class="form-control password" name="password"
                                    required autocomplete="current-password">
                                 <div class="input-group-append">
                                    <span class="input-group-text">
                                    <i class="fas fa-key"></i>
                                    </span>
                                 </div>
                                 <span class="invalid-feedback d-block" role="alert">
                                    <strong class="error-password"></strong>
                                  </span>
                              </div>
                           </div>
                           <div class="form-group">
                              <button type="submit" class="btn btn-primary submit-btn btn-block login-button">
                              Login
                              </button>
                           </div>
                           <div class="form-group d-flex justify-content-between">
                              <div class="form-check form-check-flat mt-0">
                                 <label class="form-check-label">
                                 <input class="form-check-input" type="checkbox" name="remember" id="remember"
                                 {{ old('remember') ? 'checked' : '' }}> Remember me
                                 </label>
                              </div>
                           </div>
                           <div class="text-block text-center my-3">
                              <span class="text-small font-weight-semibold">Not a member ?</span>
                              <a href="registerWindow.html" class="text-black text-small">Create new account</a>
                           </div>
                        </form>
                        <div class="text-center social-btn">
                           <h3 class="title">Or</h3>
                           <p class="text">Sign In with social media</p>
                           <a href="#" class="btn btn-primary rounded-circle"><i class="fa fa-facebook"></i></a>
                           <a href="#" class="btn btn-info rounded-circle"><i class="fa fa-twitter"></i></a>
                           <a href="#" class="btn btn-danger rounded-circle"><i class="fa fa-google"></i></a>
                        </div>
                     </div>
                  </div>
                  <div class="row mt-3">
                     <div class="col-6">
                        <a href="" class="text-light"><small>Forgot password?</small></a>
                     </div>
                  </div>
               </div>
            </div>
         </div>
      </div>
   <footer class="py-5">
      <div class="container">
         <div class="row align-items-center justify-content-xl-between">
            <div class="col-xl-6">
               <div class="copyright text-center text-xl-left text-muted">
                  <x-copyright-text>© Copyright 2022, Stitchel, LLC. All rights reserved.</x-copyright-text>
               </div>
            </div>
         </div>
      </div>
   </footer>
   <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js" type="text/javascript"></script>
   <script type="text/javascript" src="../config/stitchel.js"></script>
   <script>
      // require('../preload/authLogin.js')
      document.querySelector(".login-button").addEventListener('click', (e) => {
          e.preventDefault();

          let url = base_url();
          let email = $('.email').val()
          let password = $('.password').val()

          let loginData = {
              email: email,
              password: password,
          };

          $.ajax({
              type: 'POST',
              url: url + '/api/v1/user/login',
              headers: {
                  'X-Requested-With': 'XMLHttpRequest'
              },
              data: loginData
          }).done(function(data) {
              $("#result").html('<div class="alert alert-success"><button type="button" class="close">×</button>Successfully Login!</div>');
              window.setTimeout(function() {
                  $(".alert").fadeTo(500, 0).slideUp(500, function() {
                      window.localStorage.setItem('access_token', data.access_token)
                      window.localStorage.setItem('name', data.name)
                      window.localStorage.setItem('email', data.email)
                      window.location.href = "searchWindow.html";
                      $(this).remove();
                  });
              }, 2000);
          }).fail(showError);

          function showError(error) {
              let err = JSON.parse(error.responseText);

              $('.error-email').html('');
              $.each(err.errors.email, function(key,value) {
                  $('.error-email').append(value);
              });

               $('.error-password').html('');
              $.each(err.errors.password, function(key,value) {
                  $('.error-password').append(value);
              });
          }
      })
   </script>
   </body>
</html>